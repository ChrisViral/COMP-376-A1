using UnityEngine;

namespace SpaceShooter
{
    [RequireComponent(typeof(Collider), typeof(AudioSource))]
    public class Vulnerability : MonoBehaviour
    {
        //Inspector fields
        [SerializeField]
        private int hp;
        [SerializeField]
        private AudioClip clip;
        [SerializeField]
        private float volume;
        public Boss boss;

        private AudioSource source;

        public bool IsActive { get; private set; } = true;

        private void Awake() => this.source = this.gameObject.GetComponent<AudioSource>();

        private void OnTriggerEnter(Collider other)
        {
            if (this.IsActive && other.CompareTag("Projectile"))
            {
                if (--this.hp == 0)
                {
                    this.boss.DestroyVulnerability();
                    Destroy(this.gameObject);
                    this.IsActive = false;
                }
                Destroy(other.gameObject);
                this.source.PlayOneShot(this.clip, this.volume);
            }
        }
    }
}